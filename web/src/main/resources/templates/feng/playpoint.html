<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<title>首页</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link href="/web/css/bootstrap.css" rel="stylesheet">
		<link rel="stylesheet" href="/web/css/viwStyle.css" />
		<link href="/web/assets/css/style.css" rel="stylesheet" type="text/css" media="all">
		<script type="text/javascript" src="/web/js/jquery-3.4.0.min.js"></script>
		<script type="text/javascript" src="/web/assets/js/bootstrap.min.js"></script>
		<script type="text/javascript" src="/web/js/vue.js"></script>
		<style type="text/css">

		</style>
	</head>

	<body>
	<div id="app">
		<div class="head_div2">
			<header class="header">
				<div class="container">
					<div class="header-area">
						<div class="logo">
							<a href="index.html"><img src="/web/assets/img/logo.png" alt="logo" /></a>
						</div>
						<div class="header-right">
							<form action="#">
								<select>
									<option value="Movies">Movies</option>
									<option value="Movies">Movies</option>
									<option value="Movies">Movies</option>
								</select>
								<input type="text"/>
								<button><i class="icofont icofont-search"></i></button>
							</form>
							<ul>
								<li><a href="#">Welcome Guest!</a></li>
								<li><a class="login-popup" href="#">Login</a></li>
							</ul>
						</div>
						<div class="menu-area">
							<div class="responsive-menu"></div>
							<div class="mainmenu">
								<ul id="primary-menu">
									<li><a class="active" href="index.html">Home</a></li>
									<li><a href="movies.html">Movies</a></li>
									<li><a href="celebrities.html">CelebritiesList</a></li>
									<li><a href="top-movies.html">Top Movies</a></li>
									<li><a href="blog.html">News</a></li>
									<li><a href="#">Pages <i class="icofont icofont-simple-down"></i></a>
										<ul>
											<li><a href="blog-details.html">Blog Details</a></li>
											<li><a href="movie-details.html">Movie Details</a></li>
										</ul>
									</li>
									<li><a class="theme-btn" href="#"><i class="icofont icofont-ticket"></i> Tickets</a></li>
								</ul>
							</div>
						</div>
					</div>
				</div>
			</header>
			<div class="login-area">
				<div class="login-box">
					<a href="#"><i class="icofont icofont-close"></i></a>
					<h2>LOGIN</h2>
					<form action="#">
						<h6>USERNAME OR EMAIL ADDRESS</h6>
						<input type="text" />
						<h6>PASSWORD</h6>
						<input type="text" />
						<div class="login-remember">
							<input type="checkbox" />
							<span>Remember Me</span>
						</div>
						<div class="login-signup">
							<span>SIGNUP</span>
						</div>
						<a href="#" class="theme-btn">LOG IN</a>
						<span>Or Via Social</span>
						<div class="login-social">
							<a href="#"><i class="icofont icofont-social-facebook"></i></a>
							<a href="#"><i class="icofont icofont-social-twitter"></i></a>
							<a href="#"><i class="icofont icofont-social-linkedin"></i></a>
							<a href="#"><i class="icofont icofont-social-google-plus"></i></a>
							<a href="#"><i class="icofont icofont-camera"></i></a>
						</div>
					</form>

				</div>
			</div>
			<div class="buy-ticket">
				<div class="container">
					<div class="buy-ticket-area">
						<a href="#"><i class="icofont icofont-close"></i></a>
						<div class="row">
							<div class="col-lg-8">
								<div class="buy-ticket-box">
									<h4>Buy Tickets</h4>
									<h5>Seat</h5>
									<h6>Screen</h6>
									<div class="ticket-box-table">
										<table class="ticket-table-seat">
											<tr>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
											</tr>
											<tr>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
											</tr>
											<tr>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
											</tr>
											<tr>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
											</tr>
											<tr>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
											</tr>
										</table>
										<table>
											<tr>
												<td>1</td>
											</tr>
											<tr>
												<td>2</td>
											</tr>
											<tr>
												<td>3</td>
											</tr>
											<tr>
												<td>4</td>
											</tr>
											<tr>
												<td>5</td>
											</tr>
										</table>
										<table class="ticket-table-seat">
											<tr>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
											</tr>
											<tr>
												<td class="active">1</td>
												<td class="active">1</td>
												<td class="active">1</td>
												<td class="active">1</td>
												<td class="active">1</td>
												<td class="active">1</td>
												<td class="active">1</td>
											</tr>
											<tr>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
											</tr>
											<tr>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
											</tr>
											<tr>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
											</tr>
										</table>
										<table>
											<tr>
												<td>1</td>
											</tr>
											<tr>
												<td>2</td>
											</tr>
											<tr>
												<td>3</td>
											</tr>
											<tr>
												<td>4</td>
											</tr>
											<tr>
												<td>5</td>
											</tr>
										</table>
										<table class="ticket-table-seat">
											<tr>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
											</tr>
											<tr>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
											</tr>
											<tr>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
											</tr>
											<tr>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
											</tr>
											<tr>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
												<td>1</td>
											</tr>
										</table>
									</div>
									<div class="ticket-box-available">
										<input type="checkbox" />
										<span>Available</span>
										<input type="checkbox" checked />
										<span>Unavailable</span>
										<input type="checkbox" />
										<span>Selected</span>
									</div>
									<a href="#" class="theme-btn">previous</a>
									<a href="#" class="theme-btn">Next</a>
								</div>
							</div>
							<div class="col-lg-3 offset-lg-1">
								<div class="buy-ticket-box mtr-30">
									<h4>Your Information</h4>
									<ul>
										<li>
											<p>Location</p>
											<span>HB Cinema Box Corner</span>
										</li>
										<li>
											<p>TIME</p>
											<span>2018.07.09   20:40</span>
										</li>
										<li>
											<p>Movie name</p>
											<span>Home Alone</span>
										</li>
										<li>
											<p>Ticket number</p>
											<span>2 Adults, 2 Children, 2 Seniors</span>
										</li>
										<li>
											<p>Price</p>
											<span>89$</span>
										</li>
									</ul>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="container-fluid">
			<div class="body_div col-sm-12 nopadding">
				<div class="bodyhead_div col-sm-12">
					<div class="bodyheadimg_div">
						<div class="photos col-sm-2 col-sm-offset-2">
							<div class="imagesdiv">
								<a href="#" class="pics">
									<img class="headimages" :src="cinema.facility"/>
								</a>
							</div>
						</div>
						<div class="massagesdiv col-sm-2">
							<div class="mescontent">
								<a href="/web/feng/cinemaIndex.html">
									<h3 class="cinemaname" v-text="cinema.cname"></h3>
								</a>
								<h5  v-text="cinema.caddress"></h5>
								<h4  v-text="cinema.phone"></h4>
							</div>
						</div>
						<div class="mapdiv col-sm-2 col-sm-offset-1 text-right">
							<div class="filmmap">
							</div>
						</div>
					</div>
				</div>

			</div>
		</div>
		<div class="container">
			<div class="body_div nopadding">
				<div class="main col-sm-12">
					<!--排片区-->
					<div class="moviecontainer">
						<div class="col-sm-12 moviepart">
							<div class="movielist col-sm-1" v-for="(movie,index) in movielist">
								<img v-if="index==0" class="filmselected" @click="changeMovie(index,$event)" :src="movie.mpic"/>
								<img v-else class="filmtable" @click="changeMovie(index,$event)" :src="movie.mpic"/>
							</div>
						</div>
						<span class="leftbtn" onclick="rightmove()"> </span>
						<span class="rightbtn" onclick="leftmove()"> </span>
						<script type="text/javascript">
							function leftmove() {
								$(".moviepart").animate({right:"0"});
								$(".moviepart").animate({left:"-700px"});
							}
							function rightmove() {
								$(".moviepart").animate({left:"0"});
								$(".moviepart").animate({right:"-700px"});
							}
						</script>
					</div>

					<!--影片详情-->
					<div>
						<div class="filmmessage-show col-sm-12">
							<!--当前选中影片基本-->
							<div class="filmInfo">
								<div>
									<h3 class="movie-name">{{nowMovie.mname}}</h3><span class="score">{{nowMovie.score}} <span class="sc">分</span></span>
								</div>
								<div class="movie-message">
									<div class="movie-mes">
										<span class="mestitle">时长:</span>
										<span class="mesvalue">{{nowMovie.longtime}}分钟</span>
									</div>
									<div class="movie-mes">
										<span class="mestitle">类型:</span>
										<span class="mesvalue" v-for="type in nowMovie.types">{{type.mtype}} </span>
									</div>
									<div class="movie-mes">
										<span class="mestitle">主演:</span>
										<span class="mesvalue">道恩·强森,杰森·斯坦森</span>
									</div>
								</div>
							</div>
							<!--当前选中影片排片时间-->
							<div class="filmtime">
								<span class="mestitle col-sm-2">可选观影时间：</span>
								<div class="col-sm-2" v-for="(day,index) in playTime">
									<span :id="'date'+index" class="dateselected dates" @click="changePlayTime(index,$event)" tabindex="1"  v-if="index==0">{{day}}</span>
									<span :id="'date'+index" class="datetable dates" @click="changePlayTime(index,$event)" tabindex="2"  v-else>{{day}}</span>
								</div>
							</div>
							<!--当前选中影片排片信息-->
							<div class="filmmess">
								<table class="filmmes">
									<thead class="filmmes_thead">
									<tr class="infoTitle_tr">
										<th class="infoTitle_th">放映时间</th>
										<th class="infoTitle_th">语言版本</th>
										<th class="infoTitle_th">放映厅</th>
										<th class="infoTitle_th">票价（元）</th>
										<th class="infoTitle_th">选座购票</th>
									</tr>
									</thead>
									<tbody class="filmmes_tbody">
									<tr class="infobody_tr_Odd" v-for="message in messageByTime">
										<td class="infobody_td">
											<span class="starttime">{{message.starttime}}</span><br /><span class="endtime">{{message.endtime}}散场</span>
										</td>
										<td class="infobody_td">
											<span class="language">{{message.cinemaRoom.type}}</span>
										</td>
										<td class="infobody_td">
											<span class="room">{{message.cinemaRoom.name}}</span>
										</td>
										<td class="infobody_td">
											<span class="price"><span class="pricefont">{{message.money}}</span></span>
										</td>
										<td class="infobody_td">
											<a class="btn-purchase" href="#">选座购票</a>
										</td>
									</tr>
									</tbody>
									<tfoot></tfoot>
								</table>
							</div>
						</div>
					</div>

				</div>

			</div>
		</div>
		<footer class="footer1">
			<div class="container">
				<div class="row">
					<div class="col-lg-3 col-sm-6">
						<div class="widget">
							<img src="assets/img/logo.png" alt="about" />
							<p>7th Harley Place, London W1G 8LZ United Kingdom</p>
							<h6><span>Call us: </span>(+880) 111 222 3456</h6>
						</div>
					</div>
					<div class="col-lg-3 col-sm-6">
						<div class="widget">
							<h4>Legal</h4>
							<ul>
								<li><a href="#">Terms of Use</a></li>
								<li><a href="#">Privacy Policy</a></li>
								<li><a href="#">Security</a></li>
							</ul>
						</div>
					</div>
					<div class="col-lg-3 col-sm-6">
						<div class="widget">
							<h4>Account</h4>
							<ul>
								<li><a href="#">My Account</a></li>
								<li><a href="#">Watchlist</a></li>
								<li><a href="#">Collections</a></li>
								<li><a href="#">User Guide</a></li>
							</ul>
						</div>
					</div>
					<div class="col-lg-3 col-sm-6">
						<div class="widget">
							<h4>Newsletter</h4>
							<p>Subscribe to our newsletter system now to get latest news from us.</p>
							<form action="#">
								<input type="text" placeholder="Enter your email.."/>
								<button>SUBSCRIBE NOW</button>
							</form>
						</div>
					</div>
				</div>
				<hr />
			</div>
			<div class="copyright">
				<div class="container">
					<div class="row">
						<div class="col-lg-6 text-center text-lg-left">
							<div class="copyright-content">
								<p>&copy; 2018 MoviePoint. All Rights <a href="http://www.17sucai.com/">Reserved</a>. Designed by themerocket</p>
							</div>
						</div>
						<div class="col-lg-6 text-center text-lg-right">
							<div class="copyright-content">
								<a href="#" class="scrollToTop">
									Back to top<i class="icofont icofont-arrow-up"></i>
								</a>
							</div>
						</div>
					</div>
				</div>
			</div>
		</footer>
		</div>
		<script type="text/javascript">


			// function datechoose(obj){
			// 	$(obj).addClass("dateselected").removeClass("datetable");
			// 	$(obj).siblings(":not(':first')").addClass("datetable").removeClass("dateselected");
			// };
			/**
			 * 格式化时间
			 * @param second
			 * @param getDateType
			 * @returns {string|number}
			 */
			function getTime(second) {
				var date =new Date(second);
				var year = date.getFullYear()
				if((date.getMonth()+1)<=9){
					var month ="0"+(date.getMonth()+1);
				}else {
					return date.getMonth()+1;
					var month =date.getMonth()+1;
				}
				if(date.getDate()<=9){
					var day =  "0"+date.getDate();
				}else {
					var day =   date.getDate();
				}
				if(date.getHours()<=9){
					var hour =  "0"+date.getHours();
				}else {
					var hour =  date.getHours();
				}
				if(date.getMinutes()<=9){
					var minutes =  "0"+date.getMinutes();
				}else {
					var minutes =  date.getMinutes();
				}
				if(date.getSeconds ()<=9){
					var seconds = "0" + date.getSeconds ();
				}else{
					var seconds =  date.getSeconds ();
				}
				return year+"-"+month+"-"+day+" "+hour+":"+minutes+":"+seconds;
			}

			$(function () {
				var app = new Vue({
					el:"#app",
					data:{
						movielist:[],
						nowMovie:{},
						playTime:[],
						nowMessage:[],
						messageByTime:[],
						cinema:{}
					},
					methods:{
						changeMovie:function (index,e) {
							//改变选择电影图片的样式
							$(e.target).addClass("filmselected").removeClass("filmtable");
							$(e.target).parent().siblings().children().addClass("filmtable").removeClass("filmselected");
							//更改电影时，默认选中最近一天的拍片信息
							$(e.target).parent().parent().parent().next().children().children(":eq(1)").children(":eq(1)").children().addClass("dateselected").removeClass("datetable");
							$(e.target).parent().parent().parent().next().children().children(":eq(1)").children(":eq(1)").children().parent().siblings().children().addClass("datetable").removeClass("dateselected");
							//改变vue对象里面当前电影的数据
							this.nowMovie=this.movielist[index]
							//改变当前电影对应的拍片信息
							this.nowMessage=this.movielist[index].movieShowtimes;
							//获取当前电影的所有拍片日期
							this.playTime = getPlayDay(this.nowMessage);
							//清除当前日期的拍片信息
							this.messageByTime.length=0;
							//获取当前电影在最近一天的拍片信息
							for(var i=0;i<_this.nowMessage.length;i++){
								if(_this.nowMessage[i].startday==_this.playTime[0]){
									_this.messageByTime.push(_this.nowMessage[i])
								}
							}

						},
						changePlayTime:function (index,e) {
							this.messageByTime.length=0;

							//改变点击元素的样式
							$(e.target).addClass("dateselected").removeClass("datetable");
							$(e.target).parent().siblings().children().addClass("datetable").removeClass("dateselected");

							//获取点击天数的怕排片信息（_this.playTime[0]）messageByTime:[]
							for(var i=0;i<this.nowMessage.length;i++){
								if(this.nowMessage[i].startday==this.playTime[index]){
									this.messageByTime.push(this.nowMessage[i]);
								}
							}
						}
					},
					created:function () {
						_this = this;

						//根据影院id查出拍片的所有电影及拍片详情
						$.ajax({
							url:"/movie-stage/movie/bycid/1",
							type:"get",
							dataType:"json",
							success:function (data) {
								//格式化时间格式
								for(i in data.list){
									for(j in data.list[i].movieShowtimes){
										data.list[i].movieShowtimes[j].playtime = getTime(data.list[i].movieShowtimes[j].playtime)
										data.list[i].movieShowtimes[j].starttime=data.list[i].movieShowtimes[j].playtime.split(" ")[1];

										data.list[i].movieShowtimes[j].startday=data.list[i].movieShowtimes[j].playtime.split(" ")[0];

										var end = Date.parse(data.list[i].movieShowtimes[j].playtime)+data.list[i].longtime*60*1000;
										data.list[i].movieShowtimes[j].endtime=getTime(end);
									}
								}
								_this.movielist=data.list;

								if(_this.movielist != null && _this.movielist.length>0){
									//获取当前展示拍片信息的电影
									_this.nowMovie=data.list[0];
									//获取当前展示电影的拍片信息
									_this.nowMessage=_this.nowMovie.movieShowtimes;
									//获取拍片的时间
									_this.playTime=getPlayDay(_this.nowMessage)

									//获取最近一天的怕排片信息（_this.playTime[0]）messageByTime:[]
									for(var i=0;i<_this.nowMessage.length;i++){
										if(_this.nowMessage[i].startday==_this.playTime[0]){
											_this.messageByTime.push(_this.nowMessage[i])
										}
									}

								}
							}
						})

						//根据影院id查出影院信息
						$.ajax({
							url:"/cinema-stage/cinema/bycid?cid=1",
							type:"get",
							dataType:"json",
							success:function (data) {
								_this.cinema=data.object
								console.log(data)
							}
						})
					}
				})
			})


			/**
			 * 根据当前电影拍片信息，获得拍片时间
			 * @param playTime
			 * @param nowMessage
			 */
			function getPlayDay(nowMessage) {
				var playTime = [];
				var flag = false;
				for(var index=0;index<nowMessage.length;index++){
					if(playTime.length < 1){
						playTime.unshift(nowMessage[index].startday);
						continue;
					}
					for (var j=0;j<playTime.length;j++) {
						if(playTime[j]==nowMessage[index].startday){
							flag = true;
							break;
						}
					}
					if(!flag){
						playTime.push(nowMessage[index].startday);
					}
					flag=false
				}
				return playTime;
			}




		</script>
	</body>

</html>